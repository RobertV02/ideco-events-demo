{% extends "base.html" %}
{% block title %}События{% endblock %}
{% block content %}
<h3>Журнал событий</h3>

<table id="logtable" class="table table-striped table-dark table-hover small align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Дата/время</th>
      <th>Источник</th>
      <th>Назначение</th>
      <th>Протокол</th>
      <th>Action</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  {% for e in events %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ e.created|date:"Y-m-d H:i:s" }}</td>
      <td>{{ e.src_ip }}</td>
      <td>{{ e.dst_ip }}</td>
      <td>{{ e.protocol }}</td>
      <td>
        <span class="badge {% if e.action == 'DROP' %}bg-danger{% else %}bg-success{% endif %}">
          {{ e.action }}
        </span>
      </td>
      <td>
        <button class="btn btn-sm btn-outline-light"
                data-bs-toggle="modal"
                data-bs-target="#m{{ e.id }}">
          Подробнее
        </button>
      </td>
    </tr>

    <!-- Modal -->
    <div class="modal fade text-dark" id="m{{ e.id }}" tabindex="-1">
      <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Событие #{{ e.id }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <dl class="row">
              <dt class="col-sm-3">Дата</dt><dd class="col-sm-9">{{ e.created }}</dd>
              <dt class="col-sm-3">Источник</dt><dd class="col-sm-9">{{ e.src_ip }}</dd>
              <dt class="col-sm-3">Назначение</dt><dd class="col-sm-9">{{ e.dst_ip }}</dd>
              <dt class="col-sm-3">Протокол</dt><dd class="col-sm-9">{{ e.protocol }}</dd>
              <dt class="col-sm-3">Действие</dt><dd class="col-sm-9">{{ e.action }}</dd>
              <dt class="col-sm-3">Raw</dt><dd class="col-sm-9"><pre class="mb-0">{{ e.raw_message }}</pre></dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_js %}
<script>
  $(function () {
    $('#logtable').DataTable({
      order: [[1,'desc']],
      pageLength: 25,
      language: {
        url: 'https://cdn.datatables.net/plug-ins/1.13.8/i18n/ru.json'
      }
    });
  });
</script>
{% endblock %}
